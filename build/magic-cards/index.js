(()=>{"use strict";var e,a={255:()=>{const e=window.wp.i18n,a=window.wp.blocks,i=window.wp.blockEditor,l=window.wp.components,r=window.wp.element,s=JSON.parse('{"UU":"child/magic-cards"}'),c=window.ReactJSXRuntime,n="https://api.scryfall.com",d=({url:a})=>{if(!a?.trim())return(0,c.jsx)("div",{className:"magic-cards-preview--empty",children:(0,e.__)("Enter a Moxfield deck URL to display the embed.","child")});const i=a.match(/moxfield\.com\/decks\/([a-zA-Z0-9_-]{1,100})/);return i?(i[1],(0,c.jsx)("div",{className:"child-magic-moxfield",children:(0,c.jsxs)("div",{className:"child-magic-moxfield__preview",children:[(0,c.jsx)("p",{children:(0,c.jsx)("strong",{children:(0,e.__)("Moxfield Deck Embed","child")})}),(0,c.jsx)("p",{children:(0,c.jsx)("small",{children:(0,e.__)("The deck will be displayed on the frontend.","child")})}),(0,c.jsx)("p",{children:(0,c.jsx)("code",{children:a})})]})})):(0,c.jsx)("div",{className:"magic-cards-preview--error",children:(0,e.__)("Invalid Moxfield URL. Please use a valid deck URL like: https://moxfield.com/decks/...","child")})},t=({cardName:a,cardImageUrl:i})=>a?.trim()?(0,c.jsxs)("div",{className:"child-magic-card",children:[(0,c.jsx)("div",{className:"child-magic-card__media",children:i?(0,c.jsx)("img",{className:"child-magic-card__image",src:i,alt:a,loading:"lazy"}):(0,c.jsx)("div",{className:"child-magic-card__placeholder","aria-hidden":"true",children:(0,c.jsx)("span",{children:"ðŸƒ"})})}),(0,c.jsx)("div",{className:"child-magic-card__meta",children:(0,c.jsx)("h3",{className:"child-magic-card__name",children:a})})]}):(0,c.jsx)("div",{className:"magic-cards-preview--empty",children:(0,e.__)("Search for a card by name to display it.","child")}),o=({prints:a,selectedPrint:i,onSelect:r})=>{if(!a||0===a.length)return null;if(1===a.length)return(0,c.jsx)("p",{className:"magic-cards-prints-info",children:(0,e.__)("Only one printing available","child")});const s=a.map(e=>({label:`${e.set_name} (${e.set.toUpperCase()}) - ${e.released_at||"Unknown"}`,value:e.id}));return(0,c.jsx)(l.SelectControl,{label:(0,e.__)("Select Print","child"),value:i?.id||"",options:[{label:(0,e.__)("Select a print...","child"),value:""},...s],onChange:e=>{const i=a.find(a=>a.id===e);i&&r(i)},help:(0,e.__)("Choose an alternative printing of this card","child")})};(0,a.registerBlockType)(s.UU,{edit:function({attributes:a,setAttributes:s}){const h=(0,i.useBlockProps)(),{displayType:m,moxfieldUrl:_,cardName:p,cardImageUrl:g,selectedPrint:u,scryfallId:x}=a,[f,v]=(0,r.useState)(""),[j,y]=(0,r.useState)(!1),[w,b]=(0,r.useState)([]),[k,N]=(0,r.useState)(""),[C,U]=(0,r.useState)([]),[S,P]=(0,r.useState)(!1);(0,r.useEffect)(()=>{p&&v(e=>e||p)},[p]);const O=async()=>{const a=f.trim();if(a){y(!0),N(""),b([]),U([]);try{const i=await fetch(`${n}/cards/search?q=${encodeURIComponent(a)}&unique=cards`);if(!i.ok)return 404===i.status?N((0,e.__)("No cards found matching your search.","child")):429===i.status?N((0,e.__)("Too many requests. Please wait a moment and try again.","child")):N((0,e.__)("Search failed. Please check your connection and try again.","child")),void y(!1);const l=((await i.json()).data||[]).slice(0,10).map(e=>({id:e.id,name:e.name,set:e.set,set_name:e.set_name,image:e.image_uris?.normal||e.image_uris?.large||e.image_uris?.small||"",released_at:e.released_at}));b(l),l.length||N((0,e.__)("No cards found matching your search.","child"))}catch(a){console.error("Error searching cards:",a),"TypeError"===a.name&&a.message.includes("fetch")?N((0,e.__)("Network error. Please check your connection and try again.","child")):N((0,e.__)("An unexpected error occurred. Please try again.","child"))}y(!1)}else N((0,e.__)("Please enter a card name to search.","child"))};return(0,c.jsxs)("div",{...h,children:[(0,c.jsxs)(i.InspectorControls,{children:[(0,c.jsx)(l.PanelBody,{title:(0,e.__)("Display Type","child"),initialOpen:!0,children:(0,c.jsx)(l.RadioControl,{label:(0,e.__)("What do you want to display?","child"),selected:m,options:[{label:(0,e.__)("Single Card","child"),value:"single"},{label:(0,e.__)("Moxfield Deck Embed","child"),value:"moxfield"}],onChange:e=>s({displayType:e})})}),"moxfield"===m&&(0,c.jsx)(l.PanelBody,{title:(0,e.__)("Moxfield Settings","child"),initialOpen:!0,children:(0,c.jsx)(l.TextControl,{label:(0,e.__)("Moxfield Deck URL","child"),value:_,onChange:e=>s({moxfieldUrl:e}),placeholder:"https://moxfield.com/decks/...",help:(0,e.__)("Enter the full URL of the Moxfield deck","child")})}),"single"===m&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(l.PanelBody,{title:(0,e.__)("Search for Card","child"),initialOpen:!0,children:[(0,c.jsx)(l.TextControl,{label:(0,e.__)("Card Name","child"),value:f,onChange:v,placeholder:(0,e.__)("Enter card name...","child"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),O())}}),(0,c.jsx)(l.Button,{variant:"primary",onClick:O,disabled:j,className:"magic-cards-search-button",children:j?(0,e.__)("Searching...","child"):(0,e.__)("Search","child")}),j&&(0,c.jsx)("div",{className:"magic-cards-loading",children:(0,c.jsx)(l.Spinner,{})}),k&&(0,c.jsx)(l.Notice,{status:"error",isDismissible:!1,children:k}),w.length>0&&(0,c.jsxs)("div",{className:"magic-cards-results",children:[(0,c.jsx)("p",{children:(0,c.jsx)("strong",{children:(0,e.__)("Select a card:","child")})}),w.map(e=>(0,c.jsxs)(l.Button,{variant:e.id===x?"primary":"secondary",onClick:()=>(e=>{s({cardName:e.name,cardImageUrl:e.image,scryfallId:e.id,selectedPrint:e}),b([]),(async e=>{P(!0);try{const a=await fetch(`${n}/cards/search?q=!"${encodeURIComponent(e)}"&unique=prints`);if(!a.ok)return console.warn("Failed to load alternative prints:",a.status),void P(!1);const i=((await a.json()).data||[]).map(e=>({id:e.id,name:e.name,set:e.set,set_name:e.set_name,image:e.image_uris?.normal||e.image_uris?.large||e.image_uris?.small||"",released_at:e.released_at}));U(i)}catch(e){console.warn("Error loading alternative prints:",e)}P(!1)})(e.name)})(e),className:"magic-cards-result",children:[(0,c.jsx)("span",{className:"magic-cards-result__name",children:e.name}),(0,c.jsxs)("span",{className:"magic-cards-result__set",children:[e.set_name," (",e.set.toUpperCase(),")"]})]},e.id))]})]}),p&&(0,c.jsxs)(l.PanelBody,{title:(0,e.__)("Card Details","child"),initialOpen:!0,children:[(0,c.jsx)(l.TextControl,{label:(0,e.__)("Card Name","child"),value:p,onChange:e=>s({cardName:e}),disabled:!0}),(0,c.jsx)(l.TextControl,{label:(0,e.__)("Image URL","child"),value:g,onChange:e=>s({cardImageUrl:e}),help:(0,e.__)("Custom image URL (optional)","child")}),S&&(0,c.jsxs)("div",{className:"magic-cards-loading",children:[(0,c.jsx)(l.Spinner,{}),(0,c.jsx)("span",{children:(0,e.__)("Loading alternative prints...","child")})]}),!S&&C.length>0&&(0,c.jsx)(o,{prints:C,selectedPrint:u,onSelect:e=>{s({cardImageUrl:e.image,scryfallId:e.id,selectedPrint:e})}})]})]})]}),"moxfield"===m?(0,c.jsx)(d,{url:_}):(0,c.jsx)(t,{cardName:p,cardImageUrl:g})]})},save:()=>null})}},i={};function l(e){var r=i[e];if(void 0!==r)return r.exports;var s=i[e]={exports:{}};return a[e](s,s.exports,l),s.exports}l.m=a,e=[],l.O=(a,i,r,s)=>{if(!i){var c=1/0;for(o=0;o<e.length;o++){for(var[i,r,s]=e[o],n=!0,d=0;d<i.length;d++)(!1&s||c>=s)&&Object.keys(l.O).every(e=>l.O[e](i[d]))?i.splice(d--,1):(n=!1,s<c&&(c=s));if(n){e.splice(o--,1);var t=r();void 0!==t&&(a=t)}}return a}s=s||0;for(var o=e.length;o>0&&e[o-1][2]>s;o--)e[o]=e[o-1];e[o]=[i,r,s]},l.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={479:0,807:0};l.O.j=a=>0===e[a];var a=(a,i)=>{var r,s,[c,n,d]=i,t=0;if(c.some(a=>0!==e[a])){for(r in n)l.o(n,r)&&(l.m[r]=n[r]);if(d)var o=d(l)}for(a&&a(i);t<c.length;t++)s=c[t],l.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return l.O(o)},i=globalThis.webpackChunktwentytwentyfive_child_blocks=globalThis.webpackChunktwentytwentyfive_child_blocks||[];i.forEach(a.bind(null,0)),i.push=a.bind(null,i.push.bind(i))})();var r=l.O(void 0,[807],()=>l(255));r=l.O(r)})();