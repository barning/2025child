(()=>{"use strict";var e,i={106:()=>{const e=window.wp.i18n,i=window.wp.blocks,a=window.wp.blockEditor,t=window.wp.components,l=window.wp.element,s=JSON.parse('{"UU":"child/media-recommendation"}'),r=window.ReactJSXRuntime,d=e=>e?e.startsWith("http")?e:`https://image.tmdb.org/t/p/w500${e}`:"",n=({mediaTitle:i,mediaType:a,posterUrl:t,releaseYear:l})=>i?.trim()?(0,r.jsxs)("div",{className:"child-media-card","aria-label":"movie"===a?(0,e.__)("Film","child"):(0,e.__)("Serie","child"),children:[(0,r.jsx)("div",{className:"child-media-card__media",children:t?(0,r.jsx)("img",{className:"child-media-card__poster",src:t,alt:i,loading:"lazy"}):(0,r.jsx)("div",{className:"child-media-card__placeholder","aria-hidden":"true"})}),(0,r.jsxs)("div",{className:"child-media-card__meta",children:[(0,r.jsx)("h3",{className:"child-media-card__title",children:i}),l?.trim()?(0,r.jsx)("p",{className:"child-media-card__year",children:l}):null]})]}):(0,r.jsx)("div",{className:"media-preview--empty",children:(0,e.__)("Bitte wÃ¤hle einen Film oder eine Serie aus der Suche aus.","child")}),c=({results:i,selectedId:a,onSelect:l})=>i.length?(0,r.jsx)("div",{className:"media-search-results",children:i.map(i=>(0,r.jsxs)(t.Button,{variant:i.id===a?"primary":"secondary",onClick:()=>l(i),className:"media-search-result"+(i.id===a?" is-active":""),children:[i.poster?(0,r.jsx)("span",{className:"media-search-result__thumb",children:(0,r.jsx)("img",{src:i.poster,alt:i.title||"",loading:"lazy"})}):(0,r.jsx)("span",{className:"media-search-result__thumb media-search-result__thumb--placeholder","aria-hidden":"true",children:"ðŸŽ¬"}),(0,r.jsxs)("span",{className:"media-search-result__details",children:[(0,r.jsx)("span",{className:"media-search-result__title",children:i.title}),i.year?(0,r.jsx)("span",{className:"media-search-result__year",children:i.year}):null,(0,r.jsx)("span",{className:"media-search-result__type",children:"movie"===i.mediaType?(0,e.__)("Film","child"):(0,e.__)("Serie","child")})]})]},i.id))}):null;(0,i.registerBlockType)(s.UU,{edit:function({attributes:i,setAttributes:s}){const o=(0,a.useBlockProps)(),{mediaTitle:h,mediaType:m,posterUrl:_,releaseYear:u,tmdbId:p}=i,[v,x]=(0,l.useState)(""),[b,w]=(0,l.useState)(!1),[y,j]=(0,l.useState)([]),[g,f]=(0,l.useState)(null),[S,T]=(0,l.useState)(""),[N,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{h&&x(e=>e||h)},[h]);const k=async()=>{const i=v.trim();if(!i)return T((0,e.__)("Bitte gib einen Suchbegriff ein.","child")),void C(!1);w(!0),T(""),j([]),f(null);try{const a=window.childMediaSearch?.ajaxUrl||"/wp-admin/admin-ajax.php",t=window.childMediaSearch?.nonce||"",l=await fetch(`${a}?action=child_tmdb_search&query=${encodeURIComponent(i)}&nonce=${t}`);if(!l.ok)throw new Error("Request failed");const s=await l.json();if(!s.success)throw new Error(s.data||"Request failed");const{movies:r=[],tv:n=[]}=s.data,c=(r||[]).slice(0,3).map(e=>({id:`movie-${e.id}`,tmdbId:e.id,title:e.title||"",year:e.release_date?new Date(e.release_date).getFullYear().toString():"",poster:d(e.poster_path),mediaType:"movie"})),o=(n||[]).slice(0,3).map(e=>({id:`tv-${e.id}`,tmdbId:e.id,title:e.name||"",year:e.first_air_date?new Date(e.first_air_date).getFullYear().toString():"",poster:d(e.poster_path),mediaType:"tv"})),h=[...c,...o];j(h),C(!0),h.length||T((0,e.__)("Keine Ergebnisse gefunden.","child"))}catch(i){console.error("Fehler beim Suchen:",i),T(i.message||(0,e.__)("Beim Suchen ist ein Fehler aufgetreten. Bitte versuche es erneut.","child")),C(!1)}w(!1)};return(0,r.jsxs)("div",{...o,children:[(0,r.jsxs)(a.InspectorControls,{children:[(0,r.jsxs)(t.PanelBody,{title:(0,e.__)("Film/Serie suchen","child"),initialOpen:!0,children:[(0,r.jsx)(t.TextControl,{label:(0,e.__)("Suche nach Titel","child"),value:v,onChange:x,placeholder:(0,e.__)("Titel eingeben...","child"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),k())}}),(0,r.jsx)(t.Button,{variant:"primary",onClick:k,disabled:b,className:"media-search-button",children:b?(0,e.__)("Suche...","child"):(0,e.__)("Suchen","child")}),b&&(0,r.jsx)("div",{className:"media-search-loading",children:(0,r.jsx)(t.Spinner,{})}),S&&(0,r.jsx)(t.Notice,{status:"error",isDismissible:!1,children:S}),!b&&N&&(0,r.jsx)(c,{results:y,selectedId:g,onSelect:e=>{f(e.id),x(e.title),s({mediaTitle:e.title||h,mediaType:e.mediaType,posterUrl:e.poster||_||"",releaseYear:e.year||u||"",tmdbId:e.tmdbId||0})}})]}),(0,r.jsxs)(t.PanelBody,{title:(0,e.__)("Details","child"),initialOpen:!0,children:[(0,r.jsx)(t.SelectControl,{label:(0,e.__)("Typ","child"),value:m,options:[{label:(0,e.__)("Film","child"),value:"movie"},{label:(0,e.__)("Serie","child"),value:"tv"}],onChange:e=>s({mediaType:e})}),(0,r.jsx)(t.TextControl,{label:(0,e.__)("Titel","child"),value:h,onChange:e=>s({mediaTitle:e})}),(0,r.jsx)(t.TextControl,{label:(0,e.__)("Jahr","child"),value:u,onChange:e=>s({releaseYear:e})}),(0,r.jsx)(t.TextControl,{label:(0,e.__)("Poster-URL","child"),value:_,onChange:e=>s({posterUrl:e}),help:(0,e.__)("Optional: Eigenes Poster einfÃ¼gen","child")})]})]}),(0,r.jsx)(n,{...i})]})},save:()=>null})}},a={};function t(e){var l=a[e];if(void 0!==l)return l.exports;var s=a[e]={exports:{}};return i[e](s,s.exports,t),s.exports}t.m=i,e=[],t.O=(i,a,l,s)=>{if(!a){var r=1/0;for(o=0;o<e.length;o++){for(var[a,l,s]=e[o],d=!0,n=0;n<a.length;n++)(!1&s||r>=s)&&Object.keys(t.O).every(e=>t.O[e](a[n]))?a.splice(n--,1):(d=!1,s<r&&(r=s));if(d){e.splice(o--,1);var c=l();void 0!==c&&(i=c)}}return i}s=s||0;for(var o=e.length;o>0&&e[o-1][2]>s;o--)e[o]=e[o-1];e[o]=[a,l,s]},t.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={382:0,530:0};t.O.j=i=>0===e[i];var i=(i,a)=>{var l,s,[r,d,n]=a,c=0;if(r.some(i=>0!==e[i])){for(l in d)t.o(d,l)&&(t.m[l]=d[l]);if(n)var o=n(t)}for(i&&i(a);c<r.length;c++)s=r[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(o)},a=globalThis.webpackChunktwentytwentyfive_child_blocks=globalThis.webpackChunktwentytwentyfive_child_blocks||[];a.forEach(i.bind(null,0)),a.push=i.bind(null,a.push.bind(a))})();var l=t.O(void 0,[530],()=>t(106));l=t.O(l)})();