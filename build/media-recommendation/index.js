(()=>{"use strict";var e,t={106:()=>{const e=window.wp.i18n,t=window.wp.blocks,i=window.wp.blockEditor,a=window.wp.components,l=window.wp.element,r=JSON.parse('{"UU":"child/media-recommendation"}'),s=window.ReactJSXRuntime,n=e=>e?e.startsWith("http")?e:`https://image.tmdb.org/t/p/w500${e}`:"",d=({mediaTitle:t,mediaType:i,posterUrl:a,releaseYear:r})=>{const n=(0,l.useRef)(null),d=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!a||!n.current||!d.current)return;const e=n.current,t=()=>{((e,t)=>{try{const i=document.createElement("canvas"),a=i.getContext("2d");i.width=50,i.height=50,a.drawImage(e,0,0,50,50);const l=a.getImageData(0,0,50,50).data;let r=0,s=0,n=0,d=0;for(let e=0;e<l.length;e+=4){const t=e/4,i=t%50,a=Math.floor(t/50);(i<5||i>45||a<5||a>45)&&(r+=l[e],s+=l[e+1],n+=l[e+2],d++)}r=Math.round(r/d),s=Math.round(s/d),n=Math.round(n/d),t(`rgb(${r}, ${s}, ${n})`)}catch(e){console.warn("Could not extract colors for ambilight effect:",e),t(null)}})(e,e=>{e&&d.current&&d.current.style.setProperty("--ambilight-color",e)})};if(!e.complete)return e.addEventListener("load",t),()=>e.removeEventListener("load",t);t()},[a]),t?.trim()?(0,s.jsxs)("div",{className:"child-media-card","aria-label":"movie"===i?(0,e.__)("Film","child"):(0,e.__)("Serie","child"),children:[(0,s.jsx)("div",{className:"child-media-card__media",ref:d,children:a?(0,s.jsx)("img",{ref:n,className:"child-media-card__poster",src:a,alt:t,loading:"lazy",crossOrigin:"anonymous"}):(0,s.jsx)("div",{className:"child-media-card__placeholder","aria-hidden":"true"})}),(0,s.jsxs)("div",{className:"child-media-card__meta",children:[(0,s.jsx)("h3",{className:"child-media-card__title",children:t}),r?.trim()?(0,s.jsx)("p",{className:"child-media-card__year",children:r}):null]})]}):(0,s.jsx)("div",{className:"media-preview--empty",children:(0,e.__)("Bitte wÃ¤hle einen Film oder eine Serie aus der Suche aus.","child")})},c=({results:t,selectedId:i,onSelect:l})=>t.length?(0,s.jsx)("div",{className:"media-search-results",children:t.map(t=>(0,s.jsxs)(a.Button,{variant:t.id===i?"primary":"secondary",onClick:()=>l(t),className:"media-search-result"+(t.id===i?" is-active":""),children:[t.poster?(0,s.jsx)("span",{className:"media-search-result__thumb",children:(0,s.jsx)("img",{src:t.poster,alt:t.title||"",loading:"lazy"})}):(0,s.jsx)("span",{className:"media-search-result__thumb media-search-result__thumb--placeholder","aria-hidden":"true",children:"ðŸŽ¬"}),(0,s.jsxs)("span",{className:"media-search-result__details",children:[(0,s.jsx)("span",{className:"media-search-result__title",children:t.title}),t.year?(0,s.jsx)("span",{className:"media-search-result__year",children:t.year}):null,(0,s.jsx)("span",{className:"media-search-result__type",children:"movie"===t.mediaType?(0,e.__)("Film","child"):(0,e.__)("Serie","child")})]})]},t.id))}):null;(0,t.registerBlockType)(r.UU,{edit:function({attributes:t,setAttributes:r}){const o=(0,i.useBlockProps)(),{mediaTitle:h,mediaType:m,posterUrl:u,releaseYear:_,tmdbId:p}=t,[v,b]=(0,l.useState)(""),[f,g]=(0,l.useState)(!1),[w,x]=(0,l.useState)([]),[y,j]=(0,l.useState)(null),[S,T]=(0,l.useState)(""),[N,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{h&&b(e=>e||h)},[h]);const k=async()=>{const t=v.trim();if(!t)return T((0,e.__)("Bitte gib einen Suchbegriff ein.","child")),void C(!1);g(!0),T(""),x([]),j(null);try{const i=window.childMediaSearch?.ajaxUrl||"/wp-admin/admin-ajax.php",a=window.childMediaSearch?.nonce||"",l=await fetch(`${i}?action=child_tmdb_search&query=${encodeURIComponent(t)}&nonce=${a}`);if(!l.ok)throw new Error("Request failed");const r=await l.json();if(!r.success)throw new Error(r.data||"Request failed");const{movies:s=[],tv:d=[]}=r.data,c=(s||[]).slice(0,3).map(e=>({id:`movie-${e.id}`,tmdbId:e.id,title:e.title||"",year:e.release_date?new Date(e.release_date).getFullYear().toString():"",poster:n(e.poster_path),mediaType:"movie"})),o=(d||[]).slice(0,3).map(e=>({id:`tv-${e.id}`,tmdbId:e.id,title:e.name||"",year:e.first_air_date?new Date(e.first_air_date).getFullYear().toString():"",poster:n(e.poster_path),mediaType:"tv"})),h=[...c,...o];x(h),C(!0),h.length||T((0,e.__)("Keine Ergebnisse gefunden.","child"))}catch(t){console.error("Fehler beim Suchen:",t),T(t.message||(0,e.__)("Beim Suchen ist ein Fehler aufgetreten. Bitte versuche es erneut.","child")),C(!1)}g(!1)};return(0,s.jsxs)("div",{...o,children:[(0,s.jsxs)(i.InspectorControls,{children:[(0,s.jsxs)(a.PanelBody,{title:(0,e.__)("Film/Serie suchen","child"),initialOpen:!0,children:[(0,s.jsx)(a.TextControl,{label:(0,e.__)("Suche nach Titel","child"),value:v,onChange:b,placeholder:(0,e.__)("Titel eingeben...","child"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),k())}}),(0,s.jsx)(a.Button,{variant:"primary",onClick:k,disabled:f,className:"media-search-button",children:f?(0,e.__)("Suche...","child"):(0,e.__)("Suchen","child")}),f&&(0,s.jsx)("div",{className:"media-search-loading",children:(0,s.jsx)(a.Spinner,{})}),S&&(0,s.jsx)(a.Notice,{status:"error",isDismissible:!1,children:S}),!f&&N&&(0,s.jsx)(c,{results:w,selectedId:y,onSelect:e=>{j(e.id),b(e.title),r({mediaTitle:e.title||h,mediaType:e.mediaType,posterUrl:e.poster||u||"",releaseYear:e.year||_||"",tmdbId:e.tmdbId||0})}})]}),(0,s.jsxs)(a.PanelBody,{title:(0,e.__)("Details","child"),initialOpen:!0,children:[(0,s.jsx)(a.SelectControl,{label:(0,e.__)("Typ","child"),value:m,options:[{label:(0,e.__)("Film","child"),value:"movie"},{label:(0,e.__)("Serie","child"),value:"tv"}],onChange:e=>r({mediaType:e})}),(0,s.jsx)(a.TextControl,{label:(0,e.__)("Titel","child"),value:h,onChange:e=>r({mediaTitle:e})}),(0,s.jsx)(a.TextControl,{label:(0,e.__)("Jahr","child"),value:_,onChange:e=>r({releaseYear:e})}),(0,s.jsx)(a.TextControl,{label:(0,e.__)("Poster-URL","child"),value:u,onChange:e=>r({posterUrl:e}),help:(0,e.__)("Optional: Eigenes Poster einfÃ¼gen","child")})]})]}),(0,s.jsx)(d,{...t})]})},save:()=>null})}},i={};function a(e){var l=i[e];if(void 0!==l)return l.exports;var r=i[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,e=[],a.O=(t,i,l,r)=>{if(!i){var s=1/0;for(o=0;o<e.length;o++){for(var[i,l,r]=e[o],n=!0,d=0;d<i.length;d++)(!1&r||s>=r)&&Object.keys(a.O).every(e=>a.O[e](i[d]))?i.splice(d--,1):(n=!1,r<s&&(s=r));if(n){e.splice(o--,1);var c=l();void 0!==c&&(t=c)}}return t}r=r||0;for(var o=e.length;o>0&&e[o-1][2]>r;o--)e[o]=e[o-1];e[o]=[i,l,r]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={382:0,530:0};a.O.j=t=>0===e[t];var t=(t,i)=>{var l,r,[s,n,d]=i,c=0;if(s.some(t=>0!==e[t])){for(l in n)a.o(n,l)&&(a.m[l]=n[l]);if(d)var o=d(a)}for(t&&t(i);c<s.length;c++)r=s[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(o)},i=globalThis.webpackChunktwentytwentyfive_child_blocks=globalThis.webpackChunktwentytwentyfive_child_blocks||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var l=a.O(void 0,[530],()=>a(106));l=a.O(l)})();