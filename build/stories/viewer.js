(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=e=>{const t=e?._open_stories?.duration_in_seconds,n=Number.isFinite(t)?t:Number(t),r=Number.isFinite(n)&&n>0?n:null;return 1e3*(null!=r?r:5)},n=()=>!e.matches,r=(e,t)=>{if(e.innerHTML="",!n())return null;const r=document.createElement("div");return r.className="story-progress-bar",e.appendChild(r),requestAnimationFrame(()=>{r.style.transition=`width ${t}ms linear`,r.style.width="100%"}),r},s=s=>{const i=s.dataset.feed;if(!i)return;const o=s.querySelector(".stories-container"),a=s.querySelector(".story-viewer"),c=s.querySelector(".story-viewer-content"),d=s.querySelector(".story-media"),l=s.querySelector(".story-progress"),u=s.querySelector(".story-close"),m=s.querySelector(".story-prev"),y=s.querySelector(".story-next");if(!(o&&a&&c&&d&&l))return;let p=[],f=-1,v=null,h=null,g=null;const b=()=>{v&&(clearTimeout(v),v=null),l.innerHTML=""},L=()=>{b(),d.innerHTML="",a.classList.remove("is-visible"),a.setAttribute("hidden","hidden"),c.setAttribute("aria-hidden","true"),h&&(document.removeEventListener("keydown",h),h=null),g instanceof HTMLElement&&g.focus(),g=null},w=()=>{f<p.length-1?A(f+1):L()},E=()=>{f>0&&A(f-1)},_=e=>{n()&&(v=setTimeout(()=>{w()},e))},A=i=>{if(i<0||i>=p.length)return;f=i;const o=p[i],u=o?._open_stories?.content_warning;d.innerHTML="",b();const v=()=>(e=>{b(),d.innerHTML="",(e?._open_stories?.mime_type||"").startsWith("video/")?(e=>{const s=e?._open_stories?.url;if(!s)return;const i=document.createElement("video");i.src=s,i.playsInline=!0,i.setAttribute("playsinline",""),i.setAttribute("webkit-playsinline",""),i.controls=!1,i.autoplay=!0,i.muted=!0;const o=()=>{const n=Number.isFinite(i.duration)&&i.duration>0?1e3*i.duration:t(e);r(l,n),_(n);const s=i.play();s&&s.catch(()=>{i.muted=!0,i.play().catch(()=>{})})};i.readyState>=1?o():i.addEventListener("loadedmetadata",o,{once:!0}),i.addEventListener("ended",()=>{n()&&w()}),d.appendChild(i)})(e):(e=>{const n=e?._open_stories?.url;if(!n)return;const s=document.createElement("img");s.src=n,s.alt=e?._open_stories?.alt||e?.title||"",s.loading="lazy",s.decoding="async",d.appendChild(s);const i=t(e);r(l,i),_(i)})(e)})(o);if(u){const t=((t,n,r)=>{const s=document.createElement("div");if(s.className="content-warning",s.textContent=n,e.matches){const e=document.createElement("button");e.type="button",e.className="content-warning__continue",e.textContent=t.dataset.continueLabel||"Continue",e.addEventListener("click",()=>{s.remove(),r()}),s.appendChild(e)}else setTimeout(()=>{s.remove(),r()},3e3);return s})(s,u,v);d.appendChild(t),l.innerHTML=""}else v();if(g=document.activeElement instanceof HTMLElement?document.activeElement:null,a.classList.add("is-visible"),a.removeAttribute("hidden"),c.setAttribute("aria-hidden","false"),"function"==typeof c.focus)try{c.focus({preventScroll:!0})}catch(e){c.focus()}m?.toggleAttribute("disabled",f<=0),y?.toggleAttribute("disabled",f>=p.length-1),h||(h=e=>{if(a.classList.contains("is-visible"))switch(e.key){case"ArrowLeft":e.preventDefault(),E();break;case"ArrowRight":e.preventDefault(),w();break;case"Escape":e.preventDefault(),L()}},document.addEventListener("keydown",h))};o.addEventListener("click",e=>{const t=e.target.closest("[data-story-id]");if(!t||t.disabled)return;const n=t.dataset.storyId,r=p.findIndex(e=>String(e.id)===String(n));-1!==r&&A(r)}),u?.addEventListener("click",L),m?.addEventListener("click",E),y?.addEventListener("click",w),a.addEventListener("click",e=>{e.target===a&&L()}),(async()=>{try{const e=await fetch(i,{credentials:"same-origin"});if(!e.ok)throw new Error(`Request failed with status ${e.status}`);const t=await e.json();p=Array.isArray(t?.items)?t.items:[],o.querySelectorAll("[data-story-id]").forEach(e=>{const t=p.some(t=>String(t.id)===e.dataset.storyId);e.toggleAttribute("disabled",!t),e.classList.toggle("story-preview--disabled",!t)}),s.classList.toggle("stories--loaded",p.length>0)}catch(e){console.error("Failed to load stories feed",e),s.classList.add("stories--error")}})()},i=()=>{document.querySelectorAll(".wp-block-twentytwentyfivechild-stories").forEach(e=>s(e))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})();